<html>
<head>	
<style>
table {
    border-collapse: collapse;
    width: 100%;
}

th, td {
    text-align: left;
    padding: 8px;
}

tr:nth-child(even){background-color: #f2f2f2}

th {
    background-color: #4CAF50;
    color: white;
}
h2 {
    color: #2a70d0;
    margin: .3em 0 .9em;
    font-size: 1.4em;
    font-family: arial,helvetica,sans-serif;
    padding-right: 7em;
    clear: left;
}
</style>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>比价</title>
	<script src="https://code.jquery.com/jquery-3.2.1.js" type="text/javascript"></script>
	<script>
		var listResult = function(data){
			$(".delRow").remove()
			for(i=0; i<=data.length-1;i++){
		  		price=data[i]
		  		trs='<tr class="delRow">'
		  		trs=trs+'<td><a target="_blank" href=' + '/static/add.html?search_id='+ price.id +'>' + price.id + '</a></td>'
		  		trs=trs+'<td>' + price.target.description + '</td>'
		  		trs=trs+'<td>' + price.target.price + '</td>'
		  		trs=trs+'<td>' + price.avg + '</td>'
		  		trs=trs+'<td>' + price.max + '</td>'
		  		trs=trs+'<td><a  target="_blank" href=' + price.min_url +'>' + price.min + '</a></td>'
		  		trs=trs+'<td>' + price.count + '</td>'
		  		trs=trs+'<td>' + price.target.updateDate + '</td>'
		  		trs=trs+'</tr>'
		  		$('#pricesTable tr:last').after(trs);
		  	}
		}
		function GetQueryString(name){
		     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
		     var r = window.location.search.substr(1).match(reg);
		     if(r!=null)return  unescape(r[2]); return null;
		}
		$(document).ready(function(){
			search = GetQueryString("search")
			if(search == "avg"){
				$.getJSON("/search/avg", listResult);
			}
			if(search == "min"){
				$.getJSON("/search/min", listResult);
			}
			if(search == "search"){
				keywords = GetQueryString("keywords")
				$.getJSON("/search?keywords=" + keywords, listResult);
			}
			$("#avgBtn").click(function(){
				window.history.pushState({},0,'http://'+window.location.host+'/static/search.html?search=avg');
				$.getJSON("/search/avg", listResult);
			});
			$("#minBtn").click(function(){
				window.history.pushState({},0,'http://'+window.location.host+'/static/search.html?search=min');
				$.getJSON("/search/min", listResult);
			});
			$("#searchBtn").click(function(){
				window.history.pushState({},0,'http://'+window.location.host+'/static/search.html?search=search&keywords=' + $("#keywords").val());
				$.getJSON("/search?keywords=" + $("#keywords").val(), listResult);
			});			
		});
	</script>
</head>
<body>
<table style="width: 600px; ">
	<tr>
		<td style="color: red">关键字(keywords):</td><td><input name="keywords" id="keywords" style="width: 365px; "></td>
	</tr>
	<tr>
		<td><input type="button" value="通过keywords查找" id="searchBtn"></td>
		<td><input type="button" value="高于均价" id="avgBtn"><input type="button" value="高于最低价" id="minBtn"></td>
	</tr>		
</table>
<table style="width: 1000px;"  id="pricesTable">
	<tr>
		<th style="width: 10px;">ID</th><th>描述</th><th style="width: 50px; ">纬雅</th><th style="width: 50px; ">平价</th><th style="width: 50px; ">最高价</th><th style="width: 50px; ">最低价</th><th style="width: 50px; ">友商数</th><th style="width: 150px; ">更新时间</th>
	</tr>
</table>
</body>
</html>